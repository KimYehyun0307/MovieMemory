{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="profile-container">
    <div class="profile-box">
        <h2>{{ user.username }}님의 프로필</h2>

        <!-- 카카오 계정일 경우 프로필 이미지 처리 -->
        {% if has_kakao_account %}
            <img src="{{ kakao_profile_image }}" alt="카카오 프로필 사진" class="profile-image">
        {% else %}
            <img src="{{ user.profile_image.url }}" alt="프로필 사진" class="profile-image" 
                onerror="this.onerror=null;this.src='{% static 'movies/default.png' %}'">
        {% endif %}

        <p><strong>아이디:</strong> {{ user.username }}</p>
        <p><strong>닉네임:</strong> {{ user.nickname }}</p>

        <!-- 수정하기 버튼 -->
        <a href="{% url 'movies:profile_edit' user.username %}" class="btn btn-primary">회원정보 변경하기</a>
    </div>

    <!-- 댓글 단 글의 목록 -->
    <div class="user-reviews profile-box">
        <h3><strong>댓글 단 글의 목록</strong></h3>

        {% if user_reviews %}
            <ul>
                {% for review in user_reviews %}
                    <li class="review-item">
                        <!-- 댓글 박스를 클릭하면 해당 영화의 상세 페이지로 이동 -->
                        <a href="{% url 'movies:detail' movie_id=review.movie.tmdb_id %}" class="review-link">
                            <div class="review-box">
                                <strong>{{ review.movie.title }}</strong> - 
                                {{ review.content|slice:":30" }}{% if review.content|length > 30 %}...{% endif %}
                            </div>
                        </a>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>아직 댓글을 단 글이 없습니다. 재미있게 본 영화의 댓글을 달아보시는 건 어떨까요?</p>
        {% endif %}
    </div>
</div>
{% endblock %}
