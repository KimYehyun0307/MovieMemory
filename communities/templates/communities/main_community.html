{% extends "base.html" %}
{% load static %}

{% block content %}
    <h1>커뮤니티 메인 페이지</h1>

    <!-- 진행 중인 이벤트 -->
    <section>
        <h2>진행 중인 이벤트</h2>
        {% if active_events %}
            <ul>
                {% for event in active_events %}
                    <li>
                        <a href="{% url 'communities:event_section' eventname=event.name %}">{{ event.name }}</a>
                        <p>{{ event.description }}</p>
                        <p>기간: {{ event.start_date|date:"Y-m-d" }} ~ {{ event.end_date|date:"Y-m-d" }}</p>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>진행 중인 이벤트가 없습니다.</p>
        {% endif %}
    </section>

    <!-- 영화 상영 일정 -->
    <section>
        <h2>영화 상영 일정</h2>
        <table>
            <thead>
                <tr>
                    <th>영화 제목</th>
                    <th>상영 일시</th>
                </tr>
            </thead>
            <tbody>
                {% for schedule in screening_schedules %}
                    <tr>
                        <td>{{ schedule.movie_title }}</td>
                        <td>{{ schedule.screening_date|date:"Y-m-d" }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <!-- 인기 게시물 -->
    <section>
        <h2>인기 게시물</h2>
        
        <div>
            <h3>영화 리뷰</h3>
            <ul>
                {% for review in popular_reviews %}
                    <li>
                        <a href="{% url 'communities:post' movie_title=review.movie.title post_num=review.id %}">{{ review.title }}</a>
                        <p>{{ review.likes }} Likes</p>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <div>
            <h3>대나무숲</h3>
            <ul>
                {% for post in popular_bamboo_posts %}
                    <li>
                        <a href="{% url 'communities:bamboo_post' post_num=post.id %}">{{ post.content|truncatewords:10 }}</a>
                        <p>{{ post.comments.count }} Comments</p>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </section>

{% endblock content %}
