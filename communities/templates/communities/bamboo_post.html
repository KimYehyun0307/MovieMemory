{% extends 'base.html' %}

{% block content %}
<h1>{{ bamboo_post.title }}</h1>
<h3>{{ bamboo_post.content }}</h3>
<p>작성자: {{ bamboo_post.display_name }}</p>

<!-- 댓글 작성 폼 -->
<h3>댓글 작성</h3>
<form method="POST">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit" name="comment_submit">댓글 작성</button>
</form>

<!-- 댓글 목록 -->
<h3>댓글</h3>
<ul>
    {% for comment in comments %}
    <li>
        {% if comment.nickname %}
            <strong>{{ comment.nickname }}:</strong>
        {% else %}
            <strong>{{ comment.anonymous_name }}:</strong>
        {% endif %}
        <p>{{ comment.content }}</p>

        <!-- 대댓글 작성 폼 -->
        <h4>대댓글 작성</h4>
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <!-- 대댓글 내용 -->
            <div class="form-group">
                <label for="id_content">대댓글 내용</label>
                <textarea name="content" id="id_content" rows="4" required></textarea>
            </div>

            <!-- 대댓글 이미지 -->
            <div class="form-group">
                <label for="id_image">대댓글 이미지</label>
                <input type="file" name="image" id="id_image">
            </div>

            <!-- 댓글 ID를 숨겨서 보내기 -->
            <input type="hidden" name="comment_id" value="{{ comment.id }}">

            <button type="submit" name="reply_submit" class="btn-submit">대댓글 작성</button>
        </form>

        <!-- 대댓글 목록 -->
        <ul>
            {% for reply in comment.replies.all %}
            <li>
                {% if reply.nickname %}
                    {{ reply.nickname }}: 
                {% else %}
                    {{ reply.anonymous_name }}: 
                {% endif %}
                {{ reply.content }}
            </li>
            {% endfor %}
        </ul>
    </li>
    {% endfor %}
</ul>

<a href="{% url 'communities:bamboo' %}">대나무숲 목록으로 돌아가기</a>
{% endblock %}
