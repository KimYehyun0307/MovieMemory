{% extends 'base.html' %}

{% block content %}
<div class="section-container">
    <h1 class="post-title">{{ bamboo_post.title }}</h1>
    <h3 class="post-content">{{ bamboo_post.content }}</h3>
    <p class="post-author">
        작성자: 
        {% if request.user == bamboo_post.user or request.user.is_superuser %}
            {{ bamboo_post.user.nickname }}  <!-- 본인이거나 superuser일 경우 nickname 표시 -->
        {% else %}
            {{ bamboo_post.display_name }}  <!-- 그렇지 않으면 display_name (익명) 표시 -->
        {% endif %}
    </p>

    <!-- 댓글 작성 섹션 -->
    <div class="comment-form-container">
        <h3>댓글 작성</h3>
        <form method="POST" class="comment-form">
            {% csrf_token %}
            {{ comment_form.as_p }}
            <button type="submit" name="comment_submit" class="btn-submit">댓글 작성</button>
        </form>
    </div>

    <!-- 댓글 목록 -->
    <h3>댓글</h3>
    <ul class="comment-box">
        {% for comment in comments %}
        <li class="comment-item">
            <strong>
                {% if request.user == comment.user or request.user.is_superuser %}
                    {{ comment.nickname }}  <!-- 본인이거나 superuser일 경우 nickname 표시 -->
                {% else %}
                    {{ comment.anonymous_name }}  <!-- 그렇지 않으면 anonymous_name (익명) 표시 -->
                {% endif %}
            </strong>
            <p>{{ comment.content }}</p>

            <!-- 대댓글 작성 섹션 -->
            <div class="reply-form-container">
                <h4>대댓글 작성</h4>
                <form method="POST" enctype="multipart/form-data" class="reply-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_content">대댓글 내용</label>
                        <textarea name="content" id="id_content" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="id_image">대댓글 이미지</label>
                        <input type="file" name="image" id="id_image">
                    </div>
                    <input type="hidden" name="comment_id" value="{{ comment.id }}">
                    <button type="submit" name="reply_submit" class="btn-submit">대댓글 작성</button>
                </form>
            </div>

            <!-- 대댓글 목록 -->
            <ul class="reply-list">
                {% for reply in comment.replies.all %}
                <li class="reply-item">
                    <strong>
                        {% if request.user == reply.user or request.user.is_superuser %}
                            {{ reply.nickname }}  <!-- 본인이거나 superuser일 경우 nickname 표시 -->
                        {% else %}
                            {{ reply.anonymous_name }}  <!-- 그렇지 않으면 anonymous_name (익명) 표시 -->
                        {% endif %}
                    </strong>
                    <p>{{ reply.content }}</p>
                </li>
                {% endfor %}
            </ul>
        </li>
        {% endfor %}
    </ul>

    <!-- 목록으로 돌아가기 -->
    <div class="navigation-buttons">
        <a href="{% url 'communities:bamboo' %}" class="btn-primary">대나무숲 목록으로 돌아가기</a>
    </div>
</div>
{% endblock %}
